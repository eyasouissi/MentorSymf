{% extends 'back/baseback.html.twig' %}

{% block title %}Add New Group{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Select2 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <!-- TinyMCE CSS (optionnel) -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tinymce/6.8.2/skins/ui/oxide/content.min.css" rel="stylesheet">
    <!-- Flatpickr CSS -->
    <link href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <style>
        body {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            font-family: 'Poppins', sans-serif;
        }

        .card {
            border-radius: 15px;
            border: none;
            background: #ffffff;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .form-control-lg, .form-select-lg {
            border-radius: 10px;
            padding: 12px 16px;
            font-size: 1.1rem;
            border: 1px solid #ced4da;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .form-control-lg:focus, .form-select-lg:focus {
            border-color: #80bdff;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }

        .form-label {
            color: #495057;
            font-size: 1.1rem;
            font-weight: 500;
        }

        .btn-lg {
            border-radius: 10px;
            padding: 10px 20px;
            font-size: 1.1rem;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .btn-lg:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .btn-success {
            background-color: #28a745;
            border-color: #28a745;
        }

        .btn-success:hover {
            background-color: #218838;
            border-color: #1e7e34;
        }

        .btn-secondary {
            background-color: #6c757d;
            border-color: #6c757d;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
            border-color: #545b62;
        }

        .needs-validation .form-control:focus {
            border-color: #80bdff;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }

        .tox-tinymce {
            border-radius: 10px;
            margin-top: 10px;
        }

        .navbar {
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .navbar-nav .nav-link {
            font-size: 1rem;
            font-weight: 500;
            color: #ffffff;
            transition: color 0.3s ease;
        }

        .navbar-nav .nav-link:hover {
            color: #f8f9fa;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 2rem;
        }

        .text-muted {
            font-size: 0.9rem;
            color: #6c757d !important;
        }

        .select2-container--default .select2-selection--multiple {
            border-radius: 10px;
            padding: 8px;
            border: 1px solid #ced4da;
        }

        .select2-container--default .select2-selection--multiple .select2-selection__choice {
            background-color: #28a745;
            border: none;
            color: white;
            border-radius: 5px;
            padding: 2px 8px;
        }

        .select2-container--default .select2-selection--multiple .select2-selection__choice__remove {
            color: white;
            margin-right: 5px;
        }

        .select2-container--default .select2-selection--multiple .select2-selection__choice__remove:hover {
            color: #e9ecef;
        }
    </style>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Select2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <!-- TinyMCE JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tinymce/6.8.2/tinymce.min.js"></script>
    <!-- Flatpickr JS -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
{% endblock %}

{% block body %}
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
        <div class="container">
            <!-- Partie à gauche (Groups et Projects) -->
            <div class="navbar-nav">
                <a class="nav-link" href="{{ path('app_group_index') }}">Groups</a>
                <a class="nav-link" href="{{ path('app_project_index') }}">Projects</a>
            </div>

            <!-- Partie à droite (Add Group et Add Project) -->
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="{{ path('app_group_new') }}">Add Group</a>
                <a class="nav-link" href="{{ path('app_project_add') }}">Add Project</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <h1 class="text-center fw-bold mb-4">Add New Group</h1>

        <!-- Formulaire -->
        <div class="card shadow-lg p-4">
            {{ form_start(form, {'attr': {'enctype': 'multipart/form-data', 'novalidate': 'novalidate', 'class': 'needs-validation'}}) }}

            <!-- Group Name -->
            <div class="mb-4">
                {{ form_label(form.nom_group, 'Group Name', {'label_attr': {'class': 'form-label fw-bold'}}) }}
                {{ form_widget(form.nom_group, {'attr': {'class': 'form-control form-control-lg', 'placeholder': 'Enter group name'}}) }}
                {{ form_errors(form.nom_group) }}
            </div>

            <!-- Members (sélection unique avec Select2) -->
            <div class="mb-4">
                {{ form_label(form.members, 'Members', {'label_attr': {'class': 'form-label fw-bold'}}) }}
                {{ form_widget(form.members, {
                    'attr': {
                        'class': 'form-select form-select-lg select2',
                        'data-placeholder': 'Select a member...'
                    }
                }) }}
                {{ form_errors(form.members) }}
                <small class="form-text text-muted">Select members of this Group</small>
            </div>

            <!-- Group Description avec TinyMCE -->
            <div class="mb-4">
                {{ form_label(form.description_group, 'Description', {'label_attr': {'class': 'form-label fw-bold'}}) }}
                {{ form_widget(form.description_group, {'attr': {'class': 'form-control form-control-lg tinymce', 'placeholder': 'Enter group description', 'rows': 4}}) }}
                {{ form_errors(form.description_group) }}
            </div>

            <!-- Group Image -->
            <div class="mb-4">
                {{ form_label(form.image, 'Group Image', {'label_attr': {'class': 'form-label fw-bold'}}) }}
                {{ form_widget(form.image, {'attr': {'class': 'form-control form-control-lg'}}) }}
                {{ form_errors(form.image) }}
                <small class="form-text text-muted">Upload an image for your group (optional).</small>
            </div>

            <!-- Date of Meet avec Flatpickr -->
            <div class="mb-4">
                {{ form_label(form.date_meet, 'Meeting Date and Time', {'label_attr': {'class': 'form-label fw-bold'}}) }}
                {{ form_widget(form.date_meet, {'attr': {'class': 'form-control form-control-lg flatpickr', 'placeholder': 'Select date and time...'}}) }}
                {{ form_errors(form.date_meet) }}
            </div>

            <!-- Projects (sélection unique avec Select2) -->
            <div class="mb-4">
                {{ form_label(form.projects, 'Project', {'label_attr': {'class': 'form-label fw-bold'}}) }}
                {{ form_widget(form.projects, {
                    'attr': {
                        'class': 'form-select form-select-lg select2',
                        'data-placeholder': 'Select a project...'
                    }
                }) }}
                {{ form_errors(form.projects) }}
                <small class="form-text text-muted">Select at least one project to assign to this Group.</small>
            </div>

            <!-- Boutons -->
            <div class="d-flex justify-content-between mt-4">
                <button type="submit" class="btn btn-success btn-lg shadow-sm">
                    <i class="fas fa-save"></i> Save Group
                </button>
                <a href="{{ path('app_group_index') }}" class="btn btn-secondary btn-lg shadow-sm">
                    <i class="fas fa-arrow-left"></i> Back to Group List
                </a>
            </div>

            {{ form_end(form) }}
        </div>
    </div>

    <!-- Initialisation de TinyMCE -->
    <script>
        tinymce.init({
            selector: '.tinymce',
            plugins: 'emoticons advlist autolink lists link image charmap preview anchor searchreplace visualblocks code fullscreen insertdatetime media table help wordcount',
            toolbar: 'undo redo | blocks | bold italic underline strikethrough | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | emoticons | link image media | code help',
            emoticons_database: 'https://cdnjs.cloudflare.com/ajax/libs/tinymce/6.8.2/emojis.min.js',
            skin: 'oxide',
            content_css: 'default',
            height: 300,
            menubar: false,
            branding: false,
        });
    </script>

    <!-- Initialisation de Flatpickr -->
    <script>
        flatpickr('.flatpickr', {
            enableTime: true,
            dateFormat: 'Y-m-d\\TH:i:s',
            minDate: 'today',
            time_24hr: true,
            minuteIncrement: 15,
        });
    </script>

    <!-- Initialisation de Select2 -->
    <script>
        $(document).ready(function() {
            $('#{{ form.members.vars.id }}').select2({
                placeholder: 'Select a member...',
                allowClear: true,
                width: '100%'
            });

            $('#{{ form.projects.vars.id }}').select2({
                placeholder: 'Select a project...',
                allowClear: true,
                width: '100%'
            });
        });
    </script>
{% endblock %}