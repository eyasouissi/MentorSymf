{% extends 'back/baseback.html.twig' %}

{% block title %}Ajouter Annonce{% endblock %}

{% block body %}
<div class="main-panel" style="margin-left: 160px; padding: 20px;">
    <div class="container-fluid d-flex justify-content-center align-items-center" style="min-height: 100vh;">
        <div class="card shadow-lg" style="width: 80%; max-width: 1000px;">
        
            <div class="card-header text-center bg-primary text-white">
                <h4 class="my-0">Ajouter une Annonce</h4>
            </div>

            <div class="card-body">
                {% for message in app.session.flashbag().get('error') %}
                    <div class="alert alert-danger">{{ message }}</div>
                {% endfor %}

                <div class="row">
                    <!-- Database Form Section -->
                    <div class="col-md-6">
                        {{ form_start(form, { 'attr': {'id': 'form_add_announcement'} }) }}

                        <!-- Titre -->
                        <div class="form-group mb-3">
                            {{ form_label(form.titre_a, 'Titre de l\'annonce:') }}
                            {{ form_widget(form.titre_a, {'attr': {'class': 'form-control', 'placeholder': 'Entrez le titre', 'id': 'titre_a'}}) }}
                            {{ form_errors(form.titre_a) }}
                        </div>

                        <!-- Description -->
                        <div class="form-group mb-3">
                            {{ form_label(form.description_a, 'Description de l\'annonce:') }}
                            {{ form_widget(form.description_a, {'attr': {'class': 'form-control', 'placeholder': 'Entrez la description', 'id': 'description_a'}}) }}
                            {{ form_errors(form.description_a) }}
                        </div>

                        <!-- Image -->
                        <div class="form-group mb-3">
                            {{ form_label(form.image_a, 'Image de l\'annonce') }}
                            {{ form_widget(form.image_a, {'attr': {'class': 'form-control'}}) }}
                            {{ form_errors(form.image_a) }}
                        </div>

                        <!-- Submit Button -->
                        <div class="form-group text-center mb-3">
                            <button type="submit" class="btn btn-primary w-100">Ajouter l'annonce</button>
                        </div>

                        {{ form_end(form) }}
                    </div>

                    <!-- QR Code Form Section -->
                    <div class="col-md-6">
                        <form id="form_qr_code">
                            <h5 class="font-weight-bold text-primary">QR Code de l'Annonce</h5>

                            <!-- QR Code Data -->
                            <div class="form-group mb-3">
                                <label for="qr_titre" class="form-label">Titre de l'annonce:</label>
                                <input type="text" class="form-control" id="qr_titre" placeholder="Entrez le titre" />
                            </div>

                            <div class="form-group mb-3">
                                <label for="qr_description" class="form-label">Description de l'annonce:</label>
                                <input type="text" class="form-control" id="qr_description" placeholder="Entrez la description" />
                            </div>

                            <!-- QR Code Display -->
                            <div id="qrcode" class="mt-3" style="text-align: center;"></div> <!-- QR Code will be generated here -->
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- QRCode.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script>
    // Function to update the QR code when form values change
    function updateQRCode() {
        const titre = document.getElementById('qr_titre').value;
        const description = document.getElementById('qr_description').value;

        const qrData = `Titre: ${titre}, Description: ${description}`;
        const qrCanvas = document.getElementById('qrcode');

        // Clear the previous QR code
        qrCanvas.innerHTML = "";

        // Generate a new QR code
        new QRCode(qrCanvas, {
            text: qrData,
            width: 200,
            height: 200,
        });
    }

    // Add event listeners to update the QR code in real-time
    window.onload = function() {
        document.getElementById('qr_titre').addEventListener('input', updateQRCode);
        document.getElementById('qr_description').addEventListener('input', updateQRCode);

        // Initial QR code generation in case the form is pre-filled
        updateQRCode();
    }
</script>
{% endblock %}
