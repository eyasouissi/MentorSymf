{% extends 'front/base.html.twig' %}

{% block title %}{{ category.name }} - D√©tails{% endblock %}

{% block body %}
<main class="main">

    <!-- Hero Section -->
    <section class="category-hero position-relative d-flex align-items-center">
        <div class="container text-center">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="category-icon mb-3">
                        {% set iconPath = asset('uploads/images/' ~ category.icon) %}
                        {% if category.icon matches '/\\.(jpg|jpeg|png|gif)$/i' %}
                            <img src="{{ iconPath }}" alt="{{ category.name }}" class="img-fluid rounded-circle shadow-lg" style="width: 120px; height: 120px; object-fit: cover;">
                        {% elseif category.icon matches '/\\.(mp4|webm|ogg)$/i' %}
                            <video width="150" height="auto" controls class="img-fluid rounded shadow-lg">
                                <source src="{{ iconPath }}" type="video/mp4">
                                Votre navigateur ne supporte pas la balise vid√©o.
                            </video>
                        {% else %}
                            <p class="text-light">Type de fichier non support√©</p>
                        {% endif %}
                    </div>
                    <h1 class="text-white fw-bold animate__animated animate__fadeInDown">{{ category.name }}</h1>
                    <p class="text-light fs-5 animate__animated animate__fadeInUp">{{ category.description }}</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Breadcrumbs -->
    <nav class="breadcrumbs bg-light py-3">
        <div class="container">
            <ol class="breadcrumb justify-content-center mb-0">
                <li class="breadcrumb-item"><a href="{{ path('app_index') }}">Accueil</a></li>
                <li class="breadcrumb-item"><a href="{{ path('category_lists') }}">Cat√©gories</a></li>
                <li class="breadcrumb-item active">{{ category.name }}</li>
            </ol>
        </div>
    </nav>

    <!-- Bouton Ajouter un Cours (pour les tuteurs) -->
    {% if is_granted('ROLE_TUTOR') %}
        <div class="text-center my-4">
            <a href="{{ path('create_course', {'id': category.id}) }}" class="btn btn-lg btn-purple shadow-sm px-4 animate__animated animate__bounceIn">
                + Add Course
            </a>
        </div>
    {% endif %}

    <!-- Section Cours -->
    <section id="courses" class="courses section py-5">
        <div class="container">
            <!-- Barre de recherche et filtre -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <input type="text" id="search-input" class="form-control" placeholder="Search for a course...">
                </div>
                <div class="col-md-6">
                    <select id="filter-select" class="form-control">
                        <option value="all">All courses</option>
                        <option value="free">Free Course</option>
                        <option value="premium">premium Course</option>
                    </select>
                </div>
            </div>

            <!-- Liste des cours -->
            <div id="course-list" class="row g-4">
                {% for course in courses %}
                    <div class="col-lg-4 col-md-6 course-item" data-premium="{{ course.premium ? 'premium' : 'free' }}">
                        <div class="course-card card border-0 shadow-sm">
                            <div class="card-body text-center">
                                <h5 class="card-title fw-bold mb-2">{{ course.title }}</h5>
                                <p class="card-text text-muted">{{ course.description|length > 100 ? course.description|slice(0, 100) ~ '...' : course.description }}</p>
                                {% if course.premium %}
                                    <a href="{{ path('offre_list_front') }}" class="btn btn-purple rounded-pill px-3">üîíPremium Course</a>
                                {% else %}
                                    <a href="{{ path('course_details', {'id': course.id}) }}" class="btn btn-outline-purple rounded-pill px-3">Details</a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>

            <!-- Pagination -->
            <div class="pagination-controls text-center my-4">
                <button id="prev-btn" class="btn btn-outline-secondary" disabled>‚¨ÖÔ∏è Previous</button>
                <span id="page-number" class="mx-3">Page 1</span>
                <button id="next-btn" class="btn btn-outline-secondary">Next ‚û°Ô∏è</button>
            </div>
        </div>
    </section>

    <!-- Bouton Retour en haut -->
    <button id="back-to-top" class="btn btn-primary btn-back-to-top shadow">
        <i class="fas fa-arrow-up"></i>
    </button>
</main>

<!-- Scripts -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const courses = Array.from(document.querySelectorAll('.course-item'));
        const searchInput = document.getElementById('search-input');
        const filterSelect = document.getElementById('filter-select');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const pageNumber = document.getElementById('page-number');

        let currentPage = 1;
        const coursesPerPage = 3;
        let filteredCourses = [...courses];

        function updatePagination() {
            const totalPages = Math.ceil(filteredCourses.length / coursesPerPage);
            pageNumber.textContent = `Page ${currentPage} / ${totalPages || 1}`;
            prevBtn.disabled = (currentPage === 1);
            nextBtn.disabled = (currentPage >= totalPages);
        }

        function displayCourses() {
            const start = (currentPage - 1) * coursesPerPage;
            const end = start + coursesPerPage;

            courses.forEach(course => course.style.display = 'none');
            filteredCourses.slice(start, end).forEach(course => course.style.display = 'block');

            updatePagination();
        }

        function filterCourses() {
            const searchTerm = searchInput.value.toLowerCase();
            const filterValue = filterSelect.value;

            filteredCourses = courses.filter(course => {
                const title = course.querySelector('.card-title').textContent.toLowerCase();
                const description = course.querySelector('.card-text').textContent.toLowerCase();
                const isPremium = course.getAttribute('data-premium') === 'premium';

                const matchesSearch = title.includes(searchTerm) || description.includes(searchTerm);
                const matchesFilter = (filterValue === 'all') || 
                                      (filterValue === 'free' && !isPremium) || 
                                      (filterValue === 'premium' && isPremium);

                return matchesSearch && matchesFilter;
            });

            currentPage = 1; 
            displayCourses();
        }

        prevBtn.addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                displayCourses();
            }
        });

        nextBtn.addEventListener('click', () => {
            const totalPages = Math.ceil(filteredCourses.length / coursesPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                displayCourses();
            }
        });

        searchInput.addEventListener('input', filterCourses);
        filterSelect.addEventListener('change', filterCourses);

        displayCourses();
    });
</script>

<!-- Styles -->
<style>
    /* Hero Section */
    .category-hero {
        background: linear-gradient(to right, rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.3)), url("https://source.unsplash.com/1600x900/?education,learning") center/cover no-repeat;
        padding: 100px 0;
        color: white;
    }

    .category-hero h1, .category-hero p {
        animation-duration: 1s;
    }

    /* Course Card */
    .course-card {
        border-radius: 12px;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .course-card:hover {
        transform: translateY(-10px);
        box-shadow: 0px 15px 30px rgba(0, 0, 0, 0.2);
    }

    /* Bouton Retour en haut */
    .btn-back-to-top {
        position: fixed;
        bottom: 20px;
        right: 20px;
        display: none;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        font-size: 1.2rem;
    }

    /* Pagination */
    .pagination-controls {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 20px;
    }

    .btn-outline-secondary {
        font-size: 1rem;
        padding: 8px 16px;
        border-radius: 20px;
    }

    .btn-outline-secondary:disabled {
        opacity: 0.5;
    }

    /* Boutons */
    .btn-purple {
        background-color: rgb(215, 165, 251);
        border: none;
        color: white;
        transition: background-color 0.3s;
    }

    .btn-purple:hover {
        background-color: rgb(190, 119, 252);
    }

    .btn-outline-purple {
        color: rgb(190, 98, 255);
        border: 2px solid rgb(227, 187, 255);
        background: transparent;
        transition: all 0.3s;
    }

    .btn-outline-purple:hover {
        background-color: rgb(193, 105, 255);
        color: white;
    }
</style>

{% endblock %}