{% extends 'front/base.html.twig' %}

{% block title %}{{ category.name }} - Détails{% endblock %}

{% block body %}
<main class="main">

    <!-- Hero Section -->
    <section class="category-hero position-relative d-flex align-items-center">
        <div class="container text-center">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="category-icon mb-3">
                        {% set iconPath = asset('uploads/images/' ~ category.icon) %}
                        {% if category.icon matches '/\\.(jpg|jpeg|png|gif)$/i' %}
                            <img src="{{ iconPath }}" alt="{{ category.name }}" class="img-fluid rounded-circle shadow-lg" style="width: 120px; height: 120px; object-fit: cover;">
                        {% elseif category.icon matches '/\\.(mp4|webm|ogg)$/i' %}
                            <video width="150" height="auto" controls class="img-fluid rounded shadow-lg">
                                <source src="{{ iconPath }}" type="video/mp4">
                                Votre navigateur ne supporte pas la balise vidéo.
                            </video>
                        {% else %}
                            <p class="text-light">Type de fichier non supporté</p>
                        {% endif %}
                    </div>
                    <h1 class="text-white fw-bold">{{ category.name }}</h1>
                    <p class="text-light fs-5">{{ category.description }}</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Breadcrumbs -->
    <nav class="breadcrumbs bg-light py-3">
        <div class="container">
            <ol class="breadcrumb justify-content-center mb-0">
                <li class="breadcrumb-item"><a href="{{ path('app_index') }}">Accueil</a></li>
                <li class="breadcrumb-item"><a href="{{ path('category_lists') }}">Catégories</a></li>
                <li class="breadcrumb-item active">{{ category.name }}</li>
            </ol>
        </div>
    </nav>

    <!-- Ajouter un Cours -->
    <div class="text-center my-4">
        <a href="{{ path('create_course', {'id': category.id}) }}" class="btn btn-lg btn-primary shadow-sm px-4">➕ Ajouter un Cours</a>
    </div>

    <!-- Section Cours -->
    <section id="courses" class="courses section py-5">
        <div class="container">
            <div id="course-list" class="row g-4">
                {% for course in courses %}
                    <div class="col-lg-4 col-md-6 course-item">
                        <div class="course-card card border-0 shadow-sm">
                            <div class="card-body text-center">
                                <h5 class="card-title fw-bold mb-2">{{ course.title }}</h5>
                                <p class="card-text text-muted">{{ course.description|length > 100 ? course.description|slice(0, 100) ~ '...' : course.description }}</p>
                                <a href="{{ path('course_details', {'id': course.id}) }}" class="btn btn-outline-primary rounded-pill px-3">Voir Détails</a>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>

            <!-- Pagination Controls -->
            <div class="pagination-controls text-center my-4">
                <button id="prev-btn" class="btn btn-outline-secondary" disabled>Précédent</button>
                <span id="page-number" class="mx-3">Page 1</span>
                <button id="next-btn" class="btn btn-outline-secondary">Suivant</button>
            </div>
        </div>
    </section>
</main>

<script>
    // Récupérer tous les cours
    const courses = document.querySelectorAll('.course-item');
    const coursesPerPage = 3;  // Nombre de cours à afficher par page
    let currentPage = 1;
    const totalPages = Math.ceil(courses.length / coursesPerPage);

    // Fonction pour afficher les cours de la page actuelle
    function displayCourses(page) {
        const start = (page - 1) * coursesPerPage;
        const end = start + coursesPerPage;
        
        // Masquer tous les cours
        courses.forEach((course, index) => {
            course.style.display = 'none';
            if (index >= start && index < end) {
                course.style.display = 'block';  // Afficher seulement les cours de la page actuelle
            }
        });

        // Afficher la page actuelle
        document.getElementById('page-number').textContent = `Page ${page}`;

        // Désactiver les boutons si on est à la première ou dernière page
        document.getElementById('prev-btn').disabled = (page === 1);
        document.getElementById('next-btn').disabled = (page === totalPages);
    }

    // Gérer les boutons Précédent et Suivant
    document.getElementById('prev-btn').addEventListener('click', () => {
        if (currentPage > 1) {
            currentPage--;
            displayCourses(currentPage);
        }
    });

    document.getElementById('next-btn').addEventListener('click', () => {
        if (currentPage < totalPages) {
            currentPage++;
            displayCourses(currentPage);
        }
    });

    // Initialiser l'affichage des cours
    displayCourses(currentPage);
</script>

<style>
    /* Hero Section */
    .category-hero {
        background: linear-gradient(to right, rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.3)), url("https://source.unsplash.com/1600x900/?education,learning") center/cover no-repeat;
        padding: 80px 0;
        color: white;
    }

    /* Breadcrumbs */
    .breadcrumbs {
        font-size: 1rem;
    }

    /* Course Card */
    .course-card {
        border-radius: 12px;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .course-card:hover {
        transform: translateY(-5px);
        box-shadow: 0px 10px 20px rgba(0, 0, 0, 0.1);
    }

    /* Pagination Controls */
    .pagination-controls {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 20px;
    }

    .btn-outline-secondary {
        font-size: 1rem;
        padding: 8px 16px;
    }

    .btn-outline-secondary:disabled {
        opacity: 0.5;
    }

    .mx-3 {
        font-size: 1.2rem;
    }

    /* Button Hover Effects */
    .btn-primary {
        background-color: #007bff;
        border: none;
        transition: background-color 0.3s;
    }

    .btn-primary:hover {
        background-color: #0056b3;
    }
</style>

{% endblock %}
