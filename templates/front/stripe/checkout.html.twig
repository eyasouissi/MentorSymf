{% extends 'front/base.html.twig' %}

{% block body %}
    <h1>Feel free to subscribe right here</h1>

    <!-- Ajouter le CSS directement dans le fichier Twig -->
    <style>
        /* Centrer le titre "Paiement" */
        h1 {
            text-align: center;
            color: #8a7f9b; /* Mauve clair */
            font-size: 3rem; /* Taille du texte */
            margin-top: 50px;
        }

        /* Styliser le bouton "Payer" */
        #checkout-button {
            display: block;
            width: 150px; /* Réduit la largeur du bouton */
            padding: 10px; /* Réduit la hauteur du bouton */
            margin: 50px auto; /* Centrer le bouton */
            background-color: #8a7f9b; /* Mauve clair */
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1rem; /* Réduit la taille du texte */
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        /* Changer la couleur du bouton au survol */
        #checkout-button:hover {
            background-color: #7b6c86; /* Une nuance un peu plus foncée de mauve clair */
        }
    </style>

    <button id="checkout-button">Payer</button>

    <script src="https://js.stripe.com/v3/"></script>
    
    <script>
    document.getElementById("checkout-button").addEventListener("click", async () => {
        try {
            const response = await fetch("/stripe/create-session", { 
                method: "POST",
                headers: { "Content-Type": "application/json" }
            });

            if (!response.ok) {
                throw new Error("Erreur lors de la création de la session Stripe");
            }

            const { id } = await response.json();

            const stripe = Stripe("{{ stripe_public_key }}");
            const { error } = await stripe.redirectToCheckout({ sessionId: id });

            if (error) {
                console.error("Erreur Stripe:", error);
                alert("Une erreur est survenue lors du paiement.");
            }
        } catch (error) {
            console.error("Erreur:", error);
            alert("Impossible de lancer le paiement.");
        }
    });
    </script>

{% endblock %}
