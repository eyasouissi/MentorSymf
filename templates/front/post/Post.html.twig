{% extends 'front/base.html.twig' %}

{% block title %}Forum - {{ forum.title }}{% endblock %}

{% block body %}
 <!-- Displaying the centered GIF image below the menu -->
    <div style="text-align: center; margin-top: 20px;">
        <img src="{{ asset('assets/img/post.gif') }}" alt="Post GIF" />
    </div>
<div class="container">
    <h1>{{ forum.title }}</h1>

    {% for message in app.flashes('success') %}
        <div class="alert alert-success">{{ message }}</div>
    {% endfor %}
    {% for message in app.flashes('error') %}
        <div class="alert alert-danger">{{ message }}</div>
    {% endfor %}

    <hr>

 <!-- Create Post Section -->
<div class="create-post-container">
    <h2>Create a New Post</h2>
    {{ form_start(form, {'attr': {'enctype': 'multipart/form-data', 'class': 'create-post-form'}}) }}
        <div class="form-group">
            {{ form_widget(form.content, {
                'attr': {
                    'class': form.content.vars.errors|length > 0 ? 'form-control is-invalid' : 'form-control'
                }
            }) }}
            <small id="word-count" class="form-text text-muted">Word count: 0</small> <!-- Display word count -->
            
            <!-- Manually render errors for content field once -->
            {% if form.content.vars.errors|length > 0 %}
                <div class="text-danger">
                    {% for error in form.content.vars.errors %}
                        <p>{{ error.message }}</p>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
        
        <div class="form-group upload-container">
            {{ form_row(form.photo, {'attr': {'class': 'form-control d-none', 'id': 'post_photo'}}) }}
            <label for="post_photo" class="upload-label">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20">
                    <path d="M10 2C5.58 2 2 5.58 2 10s3.58 8 8 8 8-3.58 8-8-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6z"></path>
                    <path d="M13 9h-2V7h-2v2H7v2h2v2h2v-2h2z"></path>
                </svg>
                <span id="file-name">Choose a photo</span>
            </label>
        </div>

    {{ form_end(form) }}
</div>
    <hr>

 <h2>Posts</h2>
<div class="posts-container">
    {% if posts is empty %}
        <p>No posts yet.</p>
    {% else %}
        {% for post in posts|reverse %}
            <div class="card mb-3" id="post-{{ post.id }}">
                <div class="card-body">
                    <div class="post-content" id="post-content-{{ post.id }}">
                        <p class="card-text">{{ post.content }}</p>
                        {% if post.photo %}
                            <img src="{{ asset('uploads/photos/' ~ post.photo) }}" class="img-fluid" style="max-width: 200px;">
                        {% endif %}
                        <p class="text-muted">Posted on {{ post.createdAt|date('Y-m-d H:i') }}</p>
                    </div>

                    <div class="post-actions">
                        <!-- Like Button -->
                        <button class="like-btn" data-post-id="{{ post.id }}">
                            <!-- SVG for Like -->
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 122.88 105.01" width="20" height="20">
                                <path class="cls-1" d="M4,43.36H32.37a4,4,0,0,1,4,4V101a4,4,0,0,1-4,4H4a4,4,0,0,1-4-4V47.39a4,4,0,0,1,4-4ZM62.16,6.3A7.36,7.36,0,0,1,66.23.65,8.14,8.14,0,0,1,71.79.34a15.36,15.36,0,0,1,5.3,2.71A26.21,26.21,0,0,1,86.81,21.9a57.41,57.41,0,0,1-.12,8.35q-.25,2.94-.76,6.15h20.2a21.58,21.58,0,0,1,9.1,2.33,14.7,14.7,0,0,1,5.6,4.92,12.55,12.55,0,0,1,2,7.51,18.1,18.1,0,0,1-1.82,6.93,21.82,21.82,0,0,1,.54,8.38,9.7,9.7,0,0,1-2.78,5.68,25.22,25.22,0,0,1-1.4,9.43,19.81,19.81,0,0,1-4.5,7,28.37,28.37,0,0,1-.9,5A17.3,17.3,0,0,1,109.5,99h0c-3.43,4.84-6.17,4.73-10.51,4.55-.61,0-1.26,0-2.26,0H57.39a19.08,19.08,0,0,1-8.86-1.78,21.13,21.13,0,0,1-7-6.06L41,94V48.15l2-.53c5.08-1.37,9.07-5.71,12.16-10.9a75.8,75.8,0,0,0,7-16.64V6.82l.06-.52Zm6.32-.78a2.15,2.15,0,0,0-1,1.57V20.46l-.12.77a82.31,82.31,0,0,1-7.61,18.24C56.4,45.09,52,49.91,46.37,52.14V93.07A14.6,14.6,0,0,0,50.93,97a14.14,14.14,0,0,0,6.46,1.21H96.73c.7,0,1.61,0,2.47.08,2.57.1,4.2.17,5.94-2.29h0a12.34,12.34,0,0,0,1.71-3.74,24.86,24.86,0,0,0,.79-5l.83-1.77a14.89,14.89,0,0,0,3.9-5.75,21.18,21.18,0,0,0,1-8.67l-.1-1.6,1.36-.84a4.09,4.09,0,0,0,1.64-3,17.44,17.44,0,0,0-.68-7.12l.21-1.94A13.12,13.12,0,0,0,117.51,51a7.29,7.29,0,0,0-1.17-4.38,9.53,9.53,0,0,0-3.59-3.12A16,16,0,0,0,106,41.77H79.51l.6-3.18a85.93,85.93,0,0,0,1.22-8.79,51,51,0,0,0,.13-7.55,20.76,20.76,0,0,0-7.62-15,10.15,10.15,0,0,0-3.41-1.79,3,3,0,0,0-2,0ZM22.64,85.3a5.13,5.13,0,1,1-5.13,5.13,5.13,5.13,0,0,1,5.13-5.13Z"/>
                            </svg>
                            <span class="like-count">{{ post.likes|default(0) }}</span>
                        </button>

                       <!-- Edit Button -->
<a href="{{ path('post_edit', {'forumId': forum.id, 'id': post.id}) }}" class="edit-btn">
    <svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 122.88 121.51" width="20" height="20">
        <title>Edit</title>
        <path d="M28.66,1.64H58.88L44.46,16.71H28.66a13.52,13.52,0,0,0-9.59,4l0,0a13.52,13.52,0,0,0-4,9.59v76.14H91.21a13.5,13.5,0,0,0,9.59-4l0,0a13.5,13.5,0,0,0,4-9.59V77.3l15.07-15.74V92.85a28.6,28.6,0,0,1-8.41,20.22l0,.05a28.58,28.58,0,0,1-20.2,8.39H11.5a11.47,11.47,0,0,1-8.1-3.37l0,0A11.52,11.52,0,0,1,0,110V30.3A28.58,28.58,0,0,1,8.41,10.09L8.46,10a28.58,28.58,0,0,1,20.2-8.4ZM73,76.47l-29.42,6,4.25-31.31L73,76.47ZM57.13,41.68,96.3.91A2.74,2.74,0,0,1,99.69.38l22.48,21.76a2.39,2.39,0,0,1-.19,3.57L82.28,67,57.13,41.68Z"/>
    </svg>
</a>

<!-- Copy Button -->
<button class="copy-btn" onclick="copyText()">
    <!-- Copy Icon SVG -->
    <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
         x="0px" y="0px" width="20" height="20" viewBox="0 0 115.77 122.88" 
         style="enable-background:new 0 0 115.77 122.88" xml:space="preserve">
        <style type="text/css">
            .st0{fill-rule:evenodd;clip-rule:evenodd;}
        </style>
        <g>
            <path class="st0" d="M89.62,13.96v7.73h12.19h0.01v0.02c3.85,0.01,7.34,1.57,9.86,4.1c2.5,2.51,4.06,5.98,4.07,9.82h0.02v0.02 
                 v73.27v0.01h-0.02c-0.01,3.84-1.57,7.33-4.1,9.86c-2.51,2.5-5.98,4.06-9.82,4.07v0.02h-0.02h-61.7H40.1v-0.02 
                 c-3.84-0.01-7.34-1.57-9.86-4.1c-2.5-2.51-4.06-5.98-4.07-9.82h-0.02v-0.02V92.51H13.96h-0.01v-0.02c-3.84-0.01-7.34-1.57-9.86-4.1 
                 c-2.5-2.51-4.06-5.98-4.07-9.82H0v-0.02V13.96v-0.01h0.02c0.01-3.85,1.58-7.34,4.1-9.86c2.51-2.5,5.98-4.06,9.82-4.07V0h0.02h61.7 
                 h0.01v0.02c3.85,0.01,7.34,1.57,9.86,4.1c2.5,2.51,4.06,5.98,4.07,9.82h0.02V13.96L89.62,13.96z M79.04,21.69v-7.73v-0.02h0.02 
                 c0-0.91-0.39-1.75-1.01-2.37c-0.61-0.61-1.46-1-2.37-1v0.02h-0.01h-61.7h-0.02v-0.02c-0.91,0-1.75,0.39-2.37,1.01 
                 c-0.61,0.61-1,1.46-1,2.37h0.02v0.01v64.59v0.02h-0.02c0,0.91,0.39,1.75,1.01,2.37c0.61,0.61,1.46,1,2.37,1v-0.02h0.01h12.19V35.65 
                 v-0.01h0.02c0.01-3.85,1.58-7.34,4.1-9.86c2.51-2.5,5.98-4.06,9.82-4.07v-0.02h0.02H79.04L79.04,21.69z M105.18,108.92V35.65v-0.02 
                 h0.02c0-0.91-0.39-1.75-1.01-2.37c-0.61-0.61-1.46-1-2.37-1v0.02h-0.01h-61.7h-0.02v-0.02c-0.91,0-1.75,0.39-2.37,1.01 
                 c-0.61,0.61-1,1.46-1,2.37h0.02v0.01v73.27v0.02h-0.02c0,0.91,0.39,1.75,1.01,2.37c0.61,0.61,1.46,1,2.37,1v-0.02h0.01h61.7h0.02 
                 v0.02c0.91,0,1.75-0.39,2.37-1.01c0.61-0.61,1-1.46,1-2.37h-0.02V108.92L105.18,108.92z"/>
        </g>
    </svg>
</button>


                        <!-- Delete Button -->
<a href="{{ path('app_post_delete', {'forumId': forum.id, 'postId': post.id}) }}" class="delete-btn"
   onclick="return confirm('Are you sure you want to delete this post?');">
    <!-- New Delete Icon SVG -->
    <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
         x="0px" y="0px" width="20" height="20" viewBox="0 0 121.31 122.876" 
         enable-background="new 0 0 121.31 122.876" xml:space="preserve">
        <g>
            <path fill-rule="evenodd" clip-rule="evenodd" 
                  d="M90.914,5.296c6.927-7.034,18.188-7.065,25.154-0.068 c6.961,6.995,6.991,18.369,0.068,25.397L85.743,61.452l30.425,30.855c6.866,6.978,6.773,18.28-0.208,25.247 
                     c-6.983,6.964-18.21,6.946-25.074-0.031L60.669,86.881L30.395,117.58c-6.927,7.034-18.188,7.065-25.154,0.068 
                     c-6.961-6.995-6.992-18.369-0.068-25.397l30.393-30.827L5.142,30.568c-6.867-6.978-6.773-18.28,0.208-25.247 
                     c6.983-6.963,18.21-6.946,25.074,0.031l30.217,30.643L90.914,5.296L90.914,5.296z"/>
        </g>
    </svg>
</a>

                    </div>
                </div>
            </div>
        {% endfor %}
    {% endif %}
</div>





<!-- Custom CSS -->
<style>
    .create-post-container {
        background: #f9f9f9;
        padding: 20px;
        border-radius: 10px;
    }
    .create-post-form .form-group {
        margin-bottom: 15px;
    }
    
    .posts-container {
    max-height: 500px; /* Adjust height as needed */
    overflow-y: auto; /* Enables vertical scrolling */
}

    .post-content {
        padding: 15px;
        background: #fff;
        border-radius: 10px;
    }
    .post-actions {
        display: flex;
        gap: 10px;
    }
  .like-btn {
    fill: #8c84a1;
    display: flex;
    align-items: center;
    gap: 5px;
    cursor: pointer;
    border: none;
    background: none;
    transition: color 0.3s, transform 0.3s; /* Add smooth transitions */
}

.like-btn:hover {
    color: blue; /* Turns the icon color blue when hovered */
    transform: scale(1.1); /* Slightly enlarges the icon on hover */
}

.like-btn svg {
    fill: #8c84a1;
}

.like-btn .like-count {
    font-size: 1.1em;
    transition: color 0.3s; /* Smooth transition for like count color */
}

.like-btn:hover .like-count {
    color: blue; /* Changes the like count color to blue on hover */
}

    /* Create Post Section */
.create-post-container {
    background-color: #f8f9fa;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    max-width: 600px;
    margin: 20px auto;
}

.create-post-container h2 {
    font-size: 24px;
    margin-bottom: 20px;
    color: #333;
}

.create-post-form {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

/* Content field */
.create-post-form .form-group {
    position: relative;
}

.create-post-form .form-control {
    padding: 15px;
    border-radius: 8px;
    border: 1px solid #ced4da;
    font-size: 16px;
    transition: all 0.3s ease;
}

.create-post-form .form-control.is-invalid {
    border-color: #dc3545;
    background-color: #f8d7da;
}

.create-post-form .form-control:focus {
    border-color: #007bff;
    box-shadow: 0 0 0 0.2rem rgba(38, 143, 255, 0.25);
    outline: none;
}

/* Word count text */
#word-count {
    font-size: 12px;
    color: #6c757d;
}

/* Error message styling */
.create-post-form .text-danger {
    font-size: 14px;
    color: #dc3545;
}

/* Upload container */
.upload-container {
    display: flex;
    align-items: center;
    gap: 10px;
}



/* Hidden input file */
.upload-container input[type="file"] {
    display: none;
}

.delete-btn svg {
    fill: #8c84a1; /* Default color for delete button */
}

.delete-btn:hover svg {
    fill: red; /* Turns red when hovered */
}

.delete-btn {
    cursor: pointer;
    transition: transform 0.3s, fill 0.3s;
}

.delete-btn:hover {
    transform: scale(1.1); /* Enlarges the delete button on hover */
}

/* General Post Actions Styles */
.post-actions {
    display: flex;
    gap: 10px;
    align-items: center;
    justify-content: flex-end;
}

/* Button Styles */
.post-actions button,
.post-actions a {
    background: none;
    border: none;
    padding: 8px;
    cursor: pointer;
    display: inline-flex;
    justify-content: center;
    align-items: center;
    border-radius: 4px;
    transition: background 0.3s, transform 0.3s;
}

/* Hover effects */
.post-actions button:hover,
.post-actions a:hover {
    background: rgba(0, 0, 0, 0.1);
    transform: scale(1.1);
}

/* Like Button */
.like-btn {
    color: #007bff;
    font-size: 16px;
}

/* Copy Button */
.copy-btn {
    color: #28a745;
    font-size: 16px;
    display: inline-flex; /* Ensures proper alignment with the SVG */
    justify-content: center;
    align-items: center;
}

.copy-btn svg {
    fill: #8c84a1;
    width: 20px; /* Ensures the SVG has a consistent size */
    height: 20px; /* Ensures the SVG has a consistent size */
    transition: fill 0.3s, transform 0.3s; /* Added transform transition for smooth scaling */
}

.copy-btn:hover svg {
    fill: #218838;
    transform: scale(1.1); /* Added scaling effect on hover */
}

/* Edit Button */
.edit-btn {
    color: #8c84a1;
    font-size: 16px;
    display: inline-flex; /* Ensures the button's content is centered */
    justify-content: center;
    align-items: center;
    cursor: pointer; /* Makes the button clickable */
}

/* SVG for Edit */
.edit-btn svg {
    fill: #8c84a1;
    width: 20px; /* Ensures consistent size */
    height: 20px; /* Ensures consistent size */
    transition: fill 0.3s, transform 0.3s; /* Adds smooth transition effects */
    vertical-align: middle; /* Aligns the SVG properly with text */
}

/* Hover effect for Edit Button */
.edit-btn:hover svg {
    fill: #e0a800; /* Change color on hover */
    transform: scale(1.1); /* Slight scale-up effect */
}




/* Optional: Add spacing around the buttons */
.post-actions button,
.post-actions a {
    margin-left: 8px;
}



/* The overlay that covers the entire page */
.modal-overlay {
    display: none; /* Hidden by default */
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7); /* Semi-transparent black */
    z-index: 1000; /* Make sure it appears above other content */
    align-items: center;
    justify-content: center;
    overflow: auto; /* Allow scrolling inside the modal if needed */
}

/* Modal content */
.modal-content {
    background-color: white;
    padding: 20px;
    border-radius: 10px;
    max-width: 600px;
    margin: 0 auto;
    position: relative;
}

/* Close button */
.close {
    position: absolute;
    top: 10px;
    right: 10px;
    font-size: 20px;
    cursor: pointer;
}

</style>
{% block javascripts %}
<script>
    document.addEventListener('DOMContentLoaded', function () {

        // Word count logic
        const contentField = document.querySelector('textarea[name="post[content]"]');
        const wordCountElement = document.getElementById('word-count');
        if (contentField) {
            contentField.addEventListener('input', function () {
                const wordCount = contentField.value.split(/\s+/).filter(Boolean).length;
                wordCountElement.textContent = `Word count: ${wordCount}`;
            });
        }

        // Like functionality
        document.querySelectorAll('.like-btn').forEach(button => {
            button.addEventListener('click', function () {
                const postId = this.getAttribute('data-post-id');
                const likeCountElement = this.querySelector('.like-count');

                fetch(`/posts/like/${postId}`, {
                    method: 'POST'
                }).then(response => response.json())
                  .then(data => {
                      if (data.success) {
                          likeCountElement.textContent = data.newLikeCount;
                      }
                  });
            });
        });

        // File upload handling
        const fileInput = document.getElementById('post_photo');
        const fileNameLabel = document.getElementById('file-name');
        if (fileInput) {
            fileInput.addEventListener('change', function () {
                const fileName = fileInput.files.length > 0 ? fileInput.files[0].name : 'Choose a photo';
                fileNameLabel.textContent = fileName;
            });
        }

        // Dropdown menu for more options
        const buttons = document.querySelectorAll(".more-options-btn");
        buttons.forEach(button => {
            button.addEventListener("click", function () {
                const postId = button.dataset.postId;
                const dropdown = document.getElementById("dropdown-" + postId);

                // Toggle the dropdown visibility
                dropdown.classList.toggle("show-dropdown");
            });
        });

        // Close the dropdown if clicked outside
        document.addEventListener("click", function (event) {
            if (!event.target.closest(".post-actions")) {
                const dropdowns = document.querySelectorAll(".dropdown-menu");
                dropdowns.forEach(dropdown => {
                    dropdown.classList.remove("show-dropdown");
                });
            }
        });

        
    });

    function copyText() {
    navigator.clipboard.writeText("Your text to copy").then(() => {
        alert("Copied to clipboard!");
    }).catch(err => {
        console.error("Failed to copy: ", err);
    });
}
</script>
{% endblock %}




{% endblock %}
